# Описательная часть

Задание для базового построения инфраструктуры на базе docker/docker-compose архитектуры

- gateway_go - шлюз системы для распределения запросов и анализа данных.
- prep_go - подготовительный сервис, который принимает данные, пред-обрабатывает их и так же гарантирует их доставку в БД.
- storage_go - сервис для записи данных в БД. Занимается распределением запросов на запись из подготовительных сервисов.

- PostgreSQL - реляционна бд для хранения данных
- Kafka - MQ система (message queue), иными словами - брокер сообщения. позволяет организовать прослойку - очередь между сервисами.
- Redis - in-mem (in memory database) используется в большей части задач как кеш, для быстрого хранения и получения данных.

## Задание 1

У вас в каталоге имеется docker-compose.yaml файл - основной файл конфигурации. В этом файле имеется готовая конфигурация, но для одного сервиса.  
1. Требуется написать по образцу уже описанного сервиса, конфигурацию для микросервиса prep_go.  
2. Запустите инфраструктуру, просмотрите что выводится в логи сервисов, при запуске не должно быть ошибок.
3. Убедившись что сервисы работают, то можно проверить работоспособность. Для этого потребуется использовать 
любую удобную на ваш взгляд утилиту: CURL, postman, insomnia...  
    1. Первый запрос для проверки работоспособности сервиса gateway.
    ```
    GET /api/
    ```

    2. Второй запрос для проверки, что данные доходят на preparer сервиса. Обратите внимание на метод запроса [POST](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST). В теле запроса может быть любая структура json.
    (Возможно сервис ответит ошибкой `Internal server error`, это нормально, так как у нас не настроена остальная часть инфраструктуры)
    ```json
    POST /api/data 

    Body. raw (JSON)
    
    {
        "author":"Быбра пожилая",
        "inherits":"Понюх быбры",
        "copies": 3,
        "certified_by_notary": true
    }
    ```



``` Можете пользоваться интернетом и другими источниками информации. Но с пониманием происходящего! ```

## Задание 2

Основываясь на задании 1 требуется по образцу настроить хранение данных.

1. Пропишите конфигурации для натройки storage_go в docker-compose.yaml.
2. Пропишите конифгурацию для настройки head_db (postgresql). Для этого основывайтесь на конфигурациях из каталога .postgres 
3. Проверьте работу конфигурацию отправив несколько запросов и посмотрев сохранившийся результат в БД.
    1. Как и в первом задании провербте что данные передаются в gateway_go. но ошибки в ответ быть не должно. (Json тело данных может быть любым)
    ```json
    POST /api/data 

    Body. raw (JSON)
    
    {
        "author":"Быбра пожилая",
        "inherits":"Понюх быбры",
        "copies": 3,
        "certified_by_notary": true
    }
    ```
    2. Для подтверждения того что в БД записались данные можете воспользоваться pgAdmin4 или другим клиентом или же проще посмотреть в сам конейнер.  
    Для этого используйте команду `docker exec -it` для контейнера с БД. в качестве команды передайте:
    ```
        psql -h localhost -U xxx heap_db
    ```
    Пример вызова команды echo - `docker exec -it name_container echo "что-то что покажем в консоли"`
    Для получения данных используйте sql команду
    ```
        SELECT * FROM data_heap;
    ```
    3. В ответе вы должны получить те данные которые отправляли. В виде таблицы. В моём случае:
    ```
    heap_db=# SELECT * FROM data_heap;
    id |                                             payload                                              
    ----+--------------------------------------------------------------------------------------------------
    1 | {"id": "0001", "value": "Some text"}
    2 | {"value": "Some text", "metric": "parameter system"}
    3 | {"author": "Быбра пожилая", "copies": 3, "inherits": "Понюх быбры", "certified_by_notary": true}
    (3 rows)
    ```
    
